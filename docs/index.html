<!DOCTYPE html>
 <html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>chronobank-smart-contracts</title><link href="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.4/semantic.min.css" rel="stylesheet"/><link href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAOVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAABHcEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcBYCzAAAAE3RSTlPkZE7emXPXAMzHihi+QAwqs6mhB70WSgAAAQFJREFUOMuFk1mSwyAMRAUWhH3J/Q8bFikxNp7pn7hKL12qbgGvfwS/T6Utqfgd4DUYAt5qBziAgwwQ8x3I0DQtEFHdgdqBYVEbgPEKRBhqe4Y+R5cugJ0AtA0HgHIFBM1BT4Nm4RfAHCzFiguAhqQekvQ0D+kpajUB8dhFCn1e/ihLdIAWc3nXRTEGKXX+WIFoDP2xfq3We0A3f+WyzAnIM7tU+jZyA5y3/QVyA3xYI70BjkNfy5IsoVlurZtKxsC9g1zLonm1mi/nsoMkA8unFa9luWlgyaLecogdGFd/dMBvHg5iGYBpc7eJOuObXt4BOm0fbyDAwPZtvrxgnS/3AwT9GsisQa84AAAAAElFTkSuQmCC" rel="icon"/><style>@import url(https://fonts.googleapis.com/css?family=Roboto:400,700|Roboto+Mono);@media only screen and (max-width:767px){[class*="computer only"]:not(.mobile),[class*="large screen only"]:not(.mobile),[class*="mobile hidden"],[class*="or lower hidden"],[class*="tablet only"]:not(.mobile),[class*="widescreen only"]:not(.mobile){display:none!important}}@media only screen and (min-width:768px) and (max-width:991px){[class*="computer only"]:not(.tablet),[class*="large screen only"]:not(.tablet),[class*="mobile only"]:not(.tablet),[class*="or lower hidden"]:not(.mobile),[class*="tablet hidden"],[class*="widescreen only"]:not(.tablet){display:none!important}}@media only screen and (min-width:992px) and (max-width:1199px){[class*="computer hidden"],[class*="large screen only"]:not(.computer),[class*="mobile only"]:not(.computer),[class*="or lower hidden"]:not(.tablet):not(.mobile),[class*="tablet only"]:not(.computer),[class*="widescreen only"]:not(.computer){display:none!important}}@media only screen and (min-width:1200px) and (max-width:1919px){[class*="computer only"]:not([class*="large screen"]),[class*="large screen hidden"],[class*="mobile only"]:not([class*="large screen"]),[class*="or lower hidden"]:not(.computer):not(.tablet):not(.mobile),[class*="tablet only"]:not([class*="large screen"]),[class*="widescreen only"]:not([class*="large screen"]){display:none!important}}@media only screen and (min-width:1920px){[class*="computer only"]:not([class*=widescreen]),[class*="large screen only"]:not([class*=widescreen]),[class*="mobile only"]:not([class*=widescreen]),[class*="tablet only"]:not([class*=widescreen]),[class*="widescreen hidden"],[class*="widescreen or lower hidden"]{display:none!important}}.ui.header,.ui.menu,body,h1,h2,h3,h4,h5{font-family:Roboto,sans-serif}pre.wrap{white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word}code{padding:0 .3em}code,pre{font-family:Roboto Mono,monospace;border:1px solid rgba(0,0,0,.05);background:rgba(0,0,0,.01)}code>code,pre>code{border:none;background:none}pre{padding:1em}.vertical.menu .item{overflow:hidden;text-overflow:ellipsis}.vertical.menu .item.active{overflow:visible}.pusher{display:flex;min-height:100vh;flex-direction:column}.pusher>.container:not(.footer){flex:1}.pusher>.footer{height:auto;margin-top:2em}.header code.signature{font-size:.6em}.ui.method-input{max-width:6em;overflow:hidden;text-overflow:ellipsis;text-align:right}.ui.method-input input{background:hsla(0,0%,100%,.7)}.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style></head><body><div id="react-mount"><div style="padding-top:60px;" class="pusher" data-reactroot="" data-reactid="1" data-react-checksum="1165018157"><div class="ui top fixed inverted menu" data-reactid="2"><div class="ui container" data-reactid="3"><a class="header item" href="/SmartContracts/" data-reactid="4"><!-- react-text: 5 -->chronobank-smart-contracts<!-- /react-text --><div class="ui grey label" data-reactid="6">1.1.44</div></a><div class="item mobile hidden" data-reactid="7">Chronobank Smart Contracts</div><div class="right menu" data-reactid="8"><a class="item" href="/SmartContracts/docs/AssetDonator/" data-reactid="9">Contracts</a></div></div></div><div class="ui container" data-reactid="10"><div class="markdown" data-reactid="11"><h1 data-reactid="12"></h1><div data-reactid="13"><h1>ChronoBank Smart Contracts <a href="https://travis-ci.org/ChronoBank/SmartContracts"><img src="https://travis-ci.org/ChronoBank/SmartContracts.svg?branch=master" alt="Build Status"></a></h1>
<h2>Overview</h2>
<p><em>ChronoBank Smart Contracts</em> ecosystem is built around two things simple for understanding: platforms and assets.</p>
<p><em>ChronoBank platforms</em> act as a base for all token operations (like issuing, balance storage, transfer) and embodied in ChronoBankPlatform contact.</p>
<p><em>ChronoBank assets</em> (instances of <em>ChronoBankAsset</em> contract) add interface layout and define some custom internal logic to allow implementing different behavior, for example, adding a fee to token transactions (look at <em>ChronoBankAssetWithFee</em> contract).</p>
<p>Since assets define just internal behavior, there are so-called <em>ChronoBank</em> asset proxies (see <em>ChronoBankAssetProxy</em> contract) which provide an <em>ERC20 standard</em> interface (described in <strong>ERC20Interface.sol</strong>) and acts as a transaction proxy. It allows to add/change token logic by updating asset implementation and to recover a wallet access in case of key loss.</p>
<p>While looking into details it could be spotted that <em>ChronoBank Smart Contracts</em> ecosystem is more than just platforms and assets. These core entities represent important but small part of all functionality.</p>
<h2>Ecosystem</h2>
<p>The next foundational block in the ecosystem is a top-level contracts module (a handful of managers) that provides all needed interfaces to organize flexible and powerful tools.</p>
<p><a href="./misc/Smart_Contracts_small_v6-1.png"><img src="./misc/Smart_Contracts_small_v6-1.png" alt="Smart_Contracts_small_v6-1.png"></a> <a href="./misc/Smart_Contracts_small_v6-1.pdf">PDF version</a> for detailed preview.</p>
<p><strong>ContractsManager</strong> plays a role in the central registry which holds references to all services registered in a system.</p>
<p>To get to the central registry contracts should be added by a contract owner of <strong>ContractsManager</strong> or those contacts that are allowed to do so (based on ACL in <strong>StorageManger</strong>).</p>
<p>It’s worth mentioning that a set of managers (top-level and others) do not store their data directly in storage, but use instead <strong>Storage</strong> contract to pass responsibility for saving data. This <strong>Storage</strong> contracts besides <strong>StorageManager</strong> are included in Shared Storage set of contracts.</p>
<p><strong>UserManager</strong> contract which role is to provide system-wide user registry where simple users and admins (<em>CBE</em>) live together. It also provides a part of multisignature infrastructure by keeping a number of admins required to confirm operations.</p>
<p><strong>PendingManager</strong> contract which provides the rest of <em>multisignature</em> functionality by holding and tracking operations performed in a system and carrying them out when a critical number of confirmations were received.</p>
<p><strong>ERC20Manager</strong> contract which keeps track of all ERC20-based tokens registered in a system.</p>
<p><strong>Events History</strong> is a submodule which performs like a gate for all events happen in a system. All system managers are using the same instance of <em>EventsHistory</em> (see <strong>MultiEventsHistory</strong> contract), other contracts created during the system’s work could use different event histories instances.</p>
<p><em>Labour-Offering Companies</em> (<strong>LOCManager</strong>) is a particular module that organizes work of <em>ChronoBank</em> with third-party companies and allows them to participate in the <em>ChronoBank</em> ecosystem (read the Whitepaper for more details).</p>
<p>The next part of modules is designed to make users’ life easier by providing additional layers of abstraction on top of existing core contracts.</p>
<h3>Key contracts</h3>
<h4>PlatformsManager</h4>
<p>The key contract is <strong>PlatformsManager</strong> that makes it possible to manipulate multiple <em>ChronoBank</em> platforms and create brand new platforms.</p>
<h4>AssetsManager</h4>
<p>The key contract is AssetsManager that allows users to build their own tokens, organize their crowdsale.</p>
<h4>WalletManager</h4>
<p>The key contract is WalletManager that give the ability to create wallets for storing tokens and organize multisignature access to its balance and transfers (it’s important to note that multisignature mechanism is independently implemented and isn’t based on PendingManager contract).</p>
<h4>Other</h4>
<p>Besides aforementioned modules there are also modules that manipulate tokens (<em>TIME</em> and other <em>ERC20</em>) tokens) to allow to:</p>
<ul>
<li>unlock system’s functionality for usage where it is needed to stake some amount of tokens to perform an operation;</li>
<li>get rewards for some period of time-based on a number of tokens user had deposited;</li>
<li>pay for unique functionality available in a system (such as creating a new platform, issuing a token, starting a token <em>crowdsale</em>, creating a <em>wallet</em> and some others).</li>
</ul>
<p>For providing such ability for a system, there were introduced a couple of contracts that are coupled with <em>Deposit</em> and <em>Feature Fee</em> modules. <em>Deposit</em> module includes:</p>
<ul>
<li><strong>Reward</strong> contract that is responsible for tracking, calculating and withdrawing rewards for token holders (in case of <em>ChronoBank</em> it is TIME tokens).</li>
<li><strong>TimeHolder</strong> keeps track of tokens stacked by users to unlock system’s functionalities Feature Fee module organizes an instrument for signing system’s functions as payable by system tokens (in case of <em>ChronoBank</em> it is <em>TIME</em> tokens).</li>
</ul>
<p>Last but not least is Additionals modules that provided extended functionalities for <em>ChronoBank</em> ecosystem:</p>
<p><strong>Crowdsale</strong> - the key contract is <strong>CrowdsaleManager</strong> and it organizes token <em>crowdsale</em>. It was made available to use only through <strong>AssetsManager</strong>.</p>
<p><strong>Voting</strong> - the key contract is VotingManager which arranges poll creation where users that hold their <em>TIME</em> tokens in <strong>TimeHolder</strong> could vote to participate in system’s decisions.</p>
<p><strong>Exchange</strong> - the key contract is <strong>ExchangeManager</strong> which coordinates exchanges between different tokens and allows users to sell/buy tokens for other tokens.</p>
<p>A more detailed version of the scheme contains internal entities and connections that participate in module’s work.</p>
<h2>Dive in!</h2>
<p>As were said <em>ChronoBank</em> ecosystem has its own token called TIME that fuels work of many functions. We gather them in one place to provide a more specific overview of their responsibilities.</p>
<p><a href="./misc/Smart_Contracts_full_v6-1.png"><img src="./misc/Smart_Contracts_full_v6-1.png" alt="Smart_Contracts_full_v6-1.png"></a> <a href="./misc/Smart_Contracts_full_v6-1.pdf">PDF version</a> for detailed preview.</p>
<h4>TimeHolder</h4>
<p>Main contracts:</p>
<ul>
<li><em>timeholder/TimeHolder.sol</em></li>
</ul>
<p>(newer version is under construction with support of using multiple ERC20 tokens as shares)</p>
<p>Deposit holder. Allows to deposit/withdraw <em>TIME</em> tokens. Users, who have deposits, are allowed to use some key features of the system such as creating <em>ERC20</em> tokens, starting crowdsale for it, create exchanges and so forth.</p>
<p>Users could deposit and withdraw at any time and those changes will appropriately update functionalities that are bound to <strong>TimeHolder</strong> (such as voting and so forth).</p>
<p><em>Dev notes</em>: New functionalities and new contracts could take advantage of using TimeHolder’s shares to secure and restrict their features: developers are able to add new contracts and use ListenerInterface to observe changes in TimeHolder’s deposits - this will unlock an access to notifications about deposit/withdrawal actions made by the user.</p>
<h4>PollManager (VotingManager.sol is under construction)</h4>
<p>Main contracts:</p>
<ul>
<li><em>vote/PollManager.sol</em>.</li>
</ul>
<p>This piece of functionality takes place in the system and is responsible for voting functions. It serves as a central point to enter and manipulate (create, navigate, stop) polls.</p>
<p>In general, it aggregates the next functions:</p>
<ul>
<li>creation of new polls,</li>
<li>tracking the number of currently active polls,</li>
<li>getting paginated lists of all created polls.</li>
</ul>
<p>Users, who have <em>TIME</em> deposits, allowed to perform a vote connected actions according to <em>TIME</em> deposit value.</p>
<h4>ExchangeManager</h4>
<p>Main contracts:</p>
<ul>
<li><em>exchange/ExchangeManager.sol</em>.</li>
</ul>
<p>It’s an exchange registry that holds information about created exchanges and provides some utility methods for managing them.</p>
<p>It serves as the entry point for creating new exchanges.</p>
<p>Standalone <strong>Exchange</strong> allows users to buy/sell assigned <em>ERC20</em> token for ether, as long as there is available supply.</p>
<p>Contract owner maintains sufficient token and ether supply, and sets buy/sell prices. In order to be able to sell tokens, the user needs to create an allowance for this contract, using standard <em>ERC20</em> <em>approve()</em> function, so that an exchange could take tokens from the user when the user orders a sell.</p>
<p><em>CBE</em> users are permitted to manage fee value against which an exchange will calculate the fee.</p>
<p>Some methods might take a fee in <em>TIME</em> tokens.</p>
<p><em>Some methods might take a fee in TIME tokens.</em></p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
<th>Price</th>
</tr>
</thead>
<tbody>
<tr>
<td>createExchange</td>
<td>Creates a new exchange with the given params.</td>
<td>TBD</td>
</tr>
</tbody>
</table>
<h4>PlatformsManager</h4>
<p>Main contracts:</p>
<ul>
<li><em>assets/PlatformsManager.sol</em>.</li>
</ul>
<p>Managing system’s and users’ platforms is possible because of this contract. It allows to create and manipulate platforms and considered as an entry point to go through user’s platforms.</p>
<p>Provides system-wide ability to manage user’s platforms. This contract allows to:</p>
<ul>
<li>create a brand new platform,</li>
<li>get a list of platforms owned by a user,</li>
<li>attach (or detach) any platforms outside the system or created somewhere by users themselves.</li>
</ul>
<p>Some methods could require paying additional fee in <em>TIME</em> tokens during their invocation</p>
<p><em>Some methods could require to pay additional fee in TIME tokens during their invocation</em></p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
<th>Price</th>
</tr>
</thead>
<tbody>
<tr>
<td>createPlatform</td>
<td>Creates a brand new platform</td>
<td>TBD</td>
</tr>
</tbody>
</table>
<h4>PlatformTokenExtensionGatewayManager</h4>
<p>Main contracts:</p>
<ul>
<li><em>assets/extensions/PlatformTokenExtensionGatewayManager.sol</em></li>
</ul>
<p>That is a backend contract specifically created to aggregate main functionality for token manipulations and make less burden on a token creation process as well as on other functions.</p>
<p>Key responsibilities are to:</p>
<ul>
<li>create assets (with and without fee),</li>
<li>create token crowdsale and remove them.</li>
</ul>
<p><em>Some methods might take a fee in TIME tokens.</em></p>
<p><em>Dev notes:</em> Since this contract is designed to be used by <em>delegatecall</em> it doesn’t inherit from any contract (except FeatureFeeAdapter) and you should be careful when a need will arise to add more functionality by inheritance because the contract uses storage layout from TokenExtensionRouter and it should be preserved.</p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
<th>Price</th>
</tr>
</thead>
<tbody>
<tr>
<td>createAssetWithoutFee</td>
<td>Creates asset without fee. Performs asset registration in ERC20Manager. Allowed to be performed only from <em>delegatecall</em> and only by platform owner.</td>
<td>TBD</td>
</tr>
<tr>
<td>createAssetWithFee</td>
<td>Creates asset with fee. Performs asset registration in ERC20Manager. Allowed to be performed only from <em>delegatecall</em> and only by platform owner.</td>
<td>TBD</td>
</tr>
<tr>
<td>createCrowdsaleCampaign</td>
<td>Creates crowdsale campaign of a token with provided symbol</td>
<td>TBD</td>
</tr>
</tbody>
</table>
<h4>Wallet</h4>
<p>Main contracts:</p>
<ul>
<li><em>wallet/WalletsManager.sol</em>,</li>
<li><em>wallet/Wallet.sol</em>.</li>
</ul>
<p>Allows to manage multisignature wallets, i.e.</p>
<ul>
<li>create wallet,</li>
<li>add wallet,</li>
<li>remove wallet.</li>
</ul>
<p>(is under construction)</p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
<th>Price</th>
</tr>
</thead>
<tbody>
<tr>
<td>createWallet()</td>
<td>Creates multisignature wallet with given params.</td>
<td>TBD</td>
</tr>
</tbody>
</table>
<h2>Documentation</h2>
<p>For more details please refer to <a href="https://chronobank.github.io/SmartContracts/">chronobank.github.io</a>.</p>
<h2>Testing</h2>
<p>Tests are included and can be run using truffle.</p>
<p>NodeJS 8+ required.</p>
<pre><code class="language-bash">npm install
<span class="hljs-built_in">export</span> NODE_OPTIONS=<span class="hljs-string">"--max_old_space_size=4096"</span>
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:$(<span class="hljs-built_in">pwd</span>)/node_modules/.bin
</code></pre>
<p>Then start TestRPC in a separate terminal by doing</p>
<pre><code class="language-bash">testrpc
</code></pre>
<p>Then run tests in a project dir by doing</p>
<pre><code class="language-bash">truffle <span class="hljs-built_in">test</span>
</code></pre>
</div></div></div><div class="ui container footer" data-reactid="14"><div class="ui small top attached compact secondary segment" data-reactid="15"><div class="ui stackable grid" data-reactid="16"><div class="row" data-reactid="17"><div class="six wide column" data-reactid="18"><b data-reactid="19"><!-- react-text: 20 -->© <!-- /react-text --><!-- react-text: 21 -->Mike Fluff &lt;mf@mikefluff.com&gt; (http://mikefluff.com)<!-- /react-text --></b><!-- react-text: 22 --> - <!-- /react-text --><!-- react-text: 23 -->GPLv3<!-- /react-text --><!-- react-text: 24 -->, <!-- /react-text --><!-- react-text: 25 -->2017<!-- /react-text --></div><div class="right aligned ten wide column" data-reactid="26"><!-- react-text: 27 -->Docs built using <!-- /react-text --><b data-reactid="28"><!-- react-text: 29 -->Solidity <!-- /react-text --></b><!-- react-text: 30 --> on <!-- /react-text --><b data-reactid="31">12/12/2017</b></div></div></div></div></div></div></div><script src="/SmartContracts/bundle.js?t=1513090434419"></script></body></html>